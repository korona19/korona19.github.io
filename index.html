<head>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
        integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
        integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
        integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
        integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
        crossorigin="anonymous"></script>
    <script src='https://cdn.plot.ly/plotly-latest.min.js'></script>
    <link href="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/js/select2.min.js"></script>
    <script>
        var countryList = ["Turkey", "Italy", "China"];
        var displayList = {
            "Turkey": { visible: true, data: { totalCase: [1, 1, 5, 5, 18, 47, 98, 191, 359, 670, 947], totalDeath: [0, 0, 0, 0, 0, 0, 0, 5, 8, 10, 12], newCase: [1, 0, 4, 0, 13, 29, 90, 200, 400, 300], newDeath: [0, 0, 0, 0, 0, 0, 0, 5, 3, 2, 2] } },
            "Italy": { visible: false, data: { totalCase: [19, 30, 50, 90, 180, 470, 980, 1910, 2000, 4000, 9470], totalDeath: [0, 10, 30, 50, 100, 300, 400, 500, 800, 1000, 1500], newCase: [10, 30, 40, 100, 300, 290, 50, 200, 4000, 3000], newDeath: [10, 10, 10, 100, 200, 300, 400, 500, 300, 200, 1000] } },
            "China": { visible: false, data: { totalCase: [190, 300, 500, 900, 1800, 4700, 9800, 19100, 20000, 40000, 94700], totalDeath: [10, 20, 100, 300, 400, 500, 600, 700, 800, 1030, 12000], newCase: [100, 50, 40, 30, 130, 290, 900, 2000, 4000, 800], newDeath: [10, 0, 10, 1000, 0, 2000, 100, 500, 300, 2200, 2500] } },
        }
        $(document).ready(function () {
            main();
        });
        colorPalette = ["rgb(255, 0, 0)", "rgb(153, 0, 0)", "rgb(0, 255, 0)", "rgb(0, 102, 51)"];


        function GetDateDifference(startDate, endDate) {
            return Math.ceil(Math.abs(endDate - startDate) / (1000 * 60 * 60 * 24));
        }

        function main() {
            DisplayCountries();
            DisplayGraph();
            $(".country").change(function () {
                displayList[this.value].visible = this.checked;
                console.log(displayList);
                DisplayGraph();
            });
            $('.countries').select2({
                data: countryList,
                maximumSelectionLength: 2,
            });
            $('#countries').on('select2:close', function (e) {
                for (element in displayList) {
                    displayList[element].visible = false;
                }
                $('#countries').select2('data').forEach(element => {
                    console.log(element);
                    displayList[element.text].visible = true;
                });

                DisplayGraph();
            });
            $('#countries').val('Turkey').trigger('change'); // Notify any JS components that the value changed

        }

        function DisplayCountries() {
            countryList.forEach(element => {
                $("#countries").append('<input type="checkbox" class="country" value="' + element + '" checked><label>' + element + '</label><br>');;
            });
        }
        function CreateGraphData() {
            var result = [];
            startDate = new Date(2020, 2, 11);
            var data_x = [];
            for (i = 0; i < 11; i++) {
                var newDate = new Date(startDate);
                newDate.setDate(startDate.getDate() + i);
                data_x.push(newDate);
            }
            var colorIndex = 0;
            for (country in displayList) {
                if (displayList[country].visible == false) {
                    continue;
                }
                result.push(
                    {
                        name: country + " - Total Case",
                        visible: "legendonly",
                        type: 'scatter',
                        marker: {
                            color: colorPalette[colorIndex],
                        },
                        x: data_x,
                        y: displayList[country].data.totalCase
                    }
                );
                result.push(
                    {
                        name: country + " - Total Death",
                        visible: "legendonly",
                        type: 'scatter',
                        marker: {
                            color: colorPalette[colorIndex + 1],
                        },
                        x: data_x,
                        y: displayList[country].data.totalDeath
                    }
                );
                result.push(
                    {
                        name: country + " - New Case",
                        type: 'bar',
                        marker: {
                            color: colorPalette[colorIndex],
                        },
                        x: data_x,
                        y: displayList[country].data.newCase
                    }
                );
                result.push(
                    {
                        name: country + " - New Death",
                        type: 'bar',
                        marker: {
                            color: colorPalette[colorIndex + 1],
                        },
                        x: data_x,
                        y: displayList[country].data.newDeath
                    }
                );
                colorIndex += 2;
            }
            return result;
        }

        function DisplayGraph() {
            var graph_data = CreateGraphData();
            var layout = {
                title: 'COVID 19',
                xaxis: {
                    tickformat: '%d.%m.%y',
                    title:{
                        text:"Date"
                    }
                },
                yaxis:{
                    title:{
                        text:"Person"
                    }
                }
            };

            Plotly.newPlot('myDiv', graph_data, layout);
        }
    </script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-161528453-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'UA-161528453-1');
    </script>
</head>

<body>
    <select id="countries" class="countries col-md-12" multiple="multiple">
    </select>
    <div id='myDiv'>
        <!-- Plotly chart will be drawn inside this DIV -->
    </div>

</body>
